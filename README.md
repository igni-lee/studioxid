# Protopie Assignment - ì‚¬ìš©ì ê´€ë¦¬ ì‹œìŠ¤í…œ

ë°±ì—”ë“œ ì—”ì§€ë‹ˆì–´ ê³¼ì œë¡œ êµ¬í˜„í•œ RESTful API ì„œë²„ì…ë‹ˆë‹¤.

## ğŸ›  ê¸°ìˆ  ìŠ¤íƒ

### Backend
- **ì–¸ì–´**: Kotlin
- **í”„ë ˆì„ì›Œí¬**: Spring Boot
- **ë¹Œë“œ ë„êµ¬**: Gradle
- **Java ë²„ì „**: OpenJDK 21

### Database & Cache
- **ì£¼ ë°ì´í„°ë² ì´ìŠ¤**: PostgreSQL 15
- **ìºì‹œ**: Redis 7
- **ORM**: Spring Data JPA + QueryDSL

### Message Queue & Async
- **ë©”ì‹œì§€ í**: RabbitMQ 3.13
- **ë¹„ë™ê¸° ì²˜ë¦¬**: Spring AMQP

### Security & Auth
- **ì¸ì¦**: JWT (JSON Web Token)
- **ì•”í˜¸í™”**: BCrypt with Salt
- **ì¸ê°€**: Role-Based Access Control (RBAC)

### Documentation & Testing
- **API ë¬¸ì„œ**: Swagger/OpenAPI 3.0
- **í…ŒìŠ¤íŠ¸**: JUnit 5, MockMvc, TestContainers
- **ì½”ë“œ í’ˆì§ˆ**: KtLint, JaCoCo

### DevOps & Infrastructure
- **ì»¨í…Œì´ë„ˆí™”**: Docker & Docker Compose


## ğŸ— ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

### ê³„ì¸µí˜• ì•„í‚¤í…ì²˜ (Layered Architecture)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Presentation Layer         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Controller  â”‚  â”‚  Global Exceptionâ”‚   â”‚
â”‚  â”‚             â”‚  â”‚     Handler     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Business Layer             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚   Service   â”‚  â”‚   Security      â”‚   â”‚
â”‚  â”‚             â”‚  â”‚   (JWT, RBAC)   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Data Access Layer          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Repository  â”‚  â”‚   Cache Layer   â”‚   â”‚
â”‚  â”‚ (JPA/QueryDSL)â”‚  â”‚    (Redis)     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Infrastructure Layer       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ PostgreSQL  â”‚  â”‚   RabbitMQ      â”‚   â”‚
â”‚  â”‚             â”‚  â”‚                 â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ì„¤ê³„ ì›ì¹™

#### 1. ë‹¨ì¼ ì±…ì„ ì›ì¹™ (SRP)
- ê° í´ë˜ìŠ¤ëŠ” í•˜ë‚˜ì˜ ì±…ì„ë§Œ ê°€ì§
- Controller: HTTP ìš”ì²­/ì‘ë‹µ ì²˜ë¦¬
- Service: ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì²˜ë¦¬
- Repository: ë°ì´í„° ì ‘ê·¼ ì²˜ë¦¬

#### 2. ì˜ì¡´ì„± ì—­ì „ ì›ì¹™ (DIP)
- ê³ ìˆ˜ì¤€ ëª¨ë“ˆì´ ì €ìˆ˜ì¤€ ëª¨ë“ˆì— ì˜ì¡´í•˜ì§€ ì•ŠìŒ
- ì¸í„°í˜ì´ìŠ¤ë¥¼ í†µí•œ ëŠìŠ¨í•œ ê²°í•©

#### 3. ê°œë°©-íì‡„ ì›ì¹™ (OCP)
- í™•ì¥ì—ëŠ” ì—´ë ¤ìˆê³  ìˆ˜ì •ì—ëŠ” ë‹«í˜€ìˆìŒ
- ìƒˆë¡œìš´ ê¸°ëŠ¥ ì¶”ê°€ ì‹œ ê¸°ì¡´ ì½”ë“œ ìˆ˜ì • ìµœì†Œí™”

## ğŸš€ ì£¼ìš” ê¸°ëŠ¥

### 1. ì¸ì¦/ì¸ê°€ ì‹œìŠ¤í…œ

#### JWT ê¸°ë°˜ ì¸ì¦
- **í† í° ìƒì„±**: ì‚¬ìš©ì ID, ì´ë©”ì¼, ì—­í•  ì •ë³´ í¬í•¨
- **í† í° ê²€ì¦**: ì„œëª… ê²€ì¦ ë° ë§Œë£Œ ì‹œê°„ í™•ì¸
- **í† í° ì¶”ì¶œ**: HTTP í—¤ë”ì—ì„œ Bearer í† í° íŒŒì‹±

#### ì—­í•  ê¸°ë°˜ ì ‘ê·¼ ì œì–´ (RBAC)
- **ADMIN**: ëª¨ë“  ì‚¬ìš©ì ê´€ë¦¬ ê¶Œí•œ
- **MEMBER**: ë³¸ì¸ ì •ë³´ë§Œ ê´€ë¦¬ ê°€ëŠ¥
- **ê¶Œí•œ ê²€ì¦**: ë©”ì„œë“œ ë ˆë²¨ ë³´ì•ˆ ì ìš©

#### ë¹„ë°€ë²ˆí˜¸ ë³´ì•ˆ
- **BCrypt í•´ì‹±**: ì•ˆì „í•œ ë¹„ë°€ë²ˆí˜¸ ì €ì¥
- **Salt ì¶”ê°€**: ë ˆì¸ë³´ìš° í…Œì´ë¸” ê³µê²© ë°©ì§€
- **ì •ì±… ê²€ì¦**: ìµœì†Œ 8ì, ì˜ë¬¸/ìˆ«ì/íŠ¹ìˆ˜ë¬¸ì í¬í•¨

### 2. ì‚¬ìš©ì ê´€ë¦¬

#### CRUD ê¸°ëŠ¥
- **ìƒì„±**: íšŒì›ê°€ì… (ì´ë©”ì¼ ì¤‘ë³µ ê²€ì¦)
- **ì¡°íšŒ**: ë³¸ì¸ ì •ë³´ ë˜ëŠ” Admin ì „ì²´ ì¡°íšŒ
- **ìˆ˜ì •**: ì´ë¦„, ì´ë©”ì¼ ë³€ê²½ (ë³¸ì¸/Admin)
- **ì‚­ì œ**: ì†Œí”„íŠ¸ ì‚­ì œ (ë…¼ë¦¬ì  ì‚­ì œ)

#### ê²€ìƒ‰ ë° í˜ì´ì§•
- **ë™ì  ê²€ìƒ‰**: QueryDSL ê¸°ë°˜ ì¡°ê±´ë¶€ ê²€ìƒ‰
- **í˜ì´ì§•**: Spring Data í˜ì´ì§• ì§€ì›
- **ì •ë ¬**: ë‹¤ì–‘í•œ í•„ë“œë³„ ì •ë ¬ ì˜µì…˜

### 3. ë¹„ë™ê¸° ì²˜ë¦¬

#### ë©”ì‹œì§€ í ê¸°ë°˜ ì‘ì—…
- **ì‚¬ìš©ì ì‚­ì œ**: ë°±ê·¸ë¼ìš´ë“œì—ì„œ ë°ì´í„° ì •ë¦¬
- **ìºì‹œ ë¬´íš¨í™”**: Redis ìºì‹œ ìë™ ì •ë¦¬
- **ë°ì´í„° ìµëª…í™”**: ê°œì¸ì •ë³´ ë³´í˜¸ ì²˜ë¦¬

#### RabbitMQ í™œìš©
- **ë©”ì‹œì§€ ë°œí–‰**: ë¹„ë™ê¸° ì‘ì—… ìš”ì²­
- **ë©”ì‹œì§€ ì†Œë¹„**: ë°±ê·¸ë¼ìš´ë“œ ì‘ì—… ì²˜ë¦¬
- **ì¬ì‹œë„ ë©”ì»¤ë‹ˆì¦˜**: ì‹¤íŒ¨ ì‹œ ìë™ ì¬ì‹œë„

### 4. ì„±ëŠ¥ ìµœì í™”

#### Redis ìºì‹±
- **ì‚¬ìš©ì ì •ë³´ ìºì‹±**: ìì£¼ ì¡°íšŒë˜ëŠ” ë°ì´í„° ìºì‹œ
- **TTL ì„¤ì •**: ìë™ ë§Œë£Œë¡œ ë©”ëª¨ë¦¬ íš¨ìœ¨ì„±
- **ìºì‹œ ë¬´íš¨í™”**: ë°ì´í„° ë³€ê²½ ì‹œ ìºì‹œ ê°±ì‹ 

#### ë°ì´í„°ë² ì´ìŠ¤ ìµœì í™”
- **ì¸ë±ìŠ¤ ìµœì í™”**: ì¡°íšŒ ì„±ëŠ¥ í–¥ìƒ
- **QueryDSL**: ë™ì  ì¿¼ë¦¬ë¡œ íš¨ìœ¨ì  ë°ì´í„° ì ‘ê·¼
- **ì—°ê²° í’€**: HikariCPë¡œ ì—°ê²° ê´€ë¦¬

## ğŸ“š API ë¬¸ì„œ

### ê¸°ë³¸ ì •ë³´
- **Base URL**: `http://localhost:8080`
- **API ë²„ì „**: v1
- **ì¸ì¦ ë°©ì‹**: JWT Bearer Token
- **ì‘ë‹µ í˜•ì‹**: JSON

### ì¸ì¦ ì—”ë“œí¬ì¸íŠ¸

#### íšŒì›ê°€ì…
```http
POST /users/signup
Content-Type: application/json

{
  "name": "í™ê¸¸ë™",
  "email": "hong@example.com",
  "password": "SecurePass123!",
  "role": "MEMBER"
}
```

**ì‘ë‹µ (201 Created)**
```json
{
  "message": "íšŒì›ê°€ì…ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤"
}
```

#### ë¡œê·¸ì¸
```http
POST /users/signin
Content-Type: application/json

{
  "email": "hong@example.com",
  "password": "SecurePass123!"
}
```

**ì‘ë‹µ (200 OK)**
```json
{
  "accessToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "expiresIn": 86400
}
```

### ì‚¬ìš©ì ê´€ë¦¬ ì—”ë“œí¬ì¸íŠ¸

#### ì‚¬ìš©ì ì¡°íšŒ
```http
GET /users/{userId}
Authorization: Bearer {jwt_token}
```

**ì‘ë‹µ (200 OK)**
```json
{
  "id": 1,
  "name": "í™ê¸¸ë™",
  "email": "hong@example.com",
  "role": "MEMBER",
  "createdAt": "2024-01-01T00:00:00",
  "updatedAt": "2024-01-01T00:00:00"
}
```

#### ì‚¬ìš©ì ìˆ˜ì •
```http
PUT /users/{userId}
Authorization: Bearer {jwt_token}
Content-Type: application/json

{
  "name": "í™ê¸¸ìˆœ",
  "email": "hong2@example.com"
}
```

#### ì‚¬ìš©ì ì‚­ì œ
```http
DELETE /users/{userId}
Authorization: Bearer {jwt_token}
```

#### ì „ì²´ ì‚¬ìš©ì ì¡°íšŒ (Adminë§Œ)
```http
GET /users?page=0&size=10&sort=createdAt&direction=desc
Authorization: Bearer {jwt_token}
```

**ì‘ë‹µ (200 OK)**
```json
{
  "content": [
    {
      "id": 1,
      "name": "í™ê¸¸ë™",
      "email": "hong@example.com",
      "role": "MEMBER",
      "createdAt": "2024-01-01T00:00:00",
      "updatedAt": "2024-01-01T00:00:00"
    }
  ],
  "page": 0,
  "size": 10,
  "totalElements": 1,
  "totalPages": 1,
  "first": true,
  "last": true
}
```

### ì—ëŸ¬ ì‘ë‹µ í˜•ì‹

```json
{
  "error": "Error Type",
  "message": "Detailed error message",
  "timestamp": "2024-01-01T00:00:00",
  "path": "/api/endpoint"
}
```

### HTTP ìƒíƒœ ì½”ë“œ

| ì½”ë“œ | ì˜ë¯¸ | ì„¤ëª… |
|------|------|------|
| 200 | OK | ìš”ì²­ ì„±ê³µ |
| 201 | Created | ë¦¬ì†ŒìŠ¤ ìƒì„± ì„±ê³µ |
| 400 | Bad Request | ì˜ëª»ëœ ìš”ì²­ |
| 401 | Unauthorized | ì¸ì¦ ì‹¤íŒ¨ |
| 403 | Forbidden | ê¶Œí•œ ì—†ìŒ |
| 404 | Not Found | ë¦¬ì†ŒìŠ¤ ì—†ìŒ |
| 409 | Conflict | ì¤‘ë³µ ë°ì´í„° |
| 500 | Internal Server Error | ì„œë²„ ì˜¤ë¥˜ |

## ğŸš€ ì„¤ì¹˜ ë° ì‹¤í–‰

### 1. ì‹¤í–‰ ë°©ë²•

#### ì „ì²´ í™˜ê²½ ì‹¤í–‰ (ê¶Œì¥)
```bash
# ëª¨ë“  ì„œë¹„ìŠ¤ ì‹œì‘
./scripts/start.sh

# ì„œë¹„ìŠ¤ ì¤‘ì§€
./scripts/stop.sh
```

#### ê°œë°œ í™˜ê²½ ì‹¤í–‰
```bash
# ì¸í”„ë¼ë§Œ ì‹¤í–‰
./scripts/start-dev.sh

# ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰
./gradlew bootRun
```

#### ìˆ˜ë™ ì‹¤í–‰
```bash
# 1. PostgreSQL ì‹œì‘
docker run -d \
  --name postgres \
  -e POSTGRES_DB=protopie_db \
  -e POSTGRES_USER=protopie_user \
  -e POSTGRES_PASSWORD=protopie_pass \
  -p 5432:5432 \
  postgres:15

# 2. Redis ì‹œì‘
docker run -d \
  --name redis \
  -p 6379:6379 \
  redis:7

# 3. RabbitMQ ì‹œì‘
docker run -d \
  --name rabbitmq \
  -p 5672:5672 \
  -p 15672:15672 \
  -e RABBITMQ_DEFAULT_USER=admin \
  -e RABBITMQ_DEFAULT_PASS=admin123 \
  rabbitmq:3-management

# 4. ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰
./gradlew bootRun
```

## ğŸ³ Docker í™˜ê²½

### ì„œë¹„ìŠ¤ êµ¬ì„±

| ì„œë¹„ìŠ¤ | í¬íŠ¸ | ì„¤ëª… |
|--------|------|------|
| Spring Boot App | 8080 | ë©”ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜ |
| PostgreSQL | 5432 | ë°ì´í„°ë² ì´ìŠ¤ |
| Redis | 6379 | ìºì‹œ ì„œë²„ |
| RabbitMQ | 5672 | ë©”ì‹œì§€ í |
| RabbitMQ Management | 15672 | ê´€ë¦¬ UI |

### ì ‘ì† ì •ë³´

- **ì• í”Œë¦¬ì¼€ì´ì…˜**: http://localhost:8080
- **Swagger UI**: http://localhost:8080/swagger-ui.html
- **API ë¬¸ì„œ**: http://localhost:8080/api-docs
- **RabbitMQ Management**: http://localhost:15672 (admin/admin123)
- **PostgreSQL**: localhost:5432 (protopie_user/protopie_pass)
- **Redis**: localhost:6379

### ê¸°ë³¸ ê³„ì •

| ì—­í•  | ì´ë©”ì¼ | ë¹„ë°€ë²ˆí˜¸ |
|------|--------|----------|
| ê´€ë¦¬ì | admin@protopie.com | admin123! |
| ì¼ë°˜ ì‚¬ìš©ì | user@protopie.com | user123! |

## ğŸ§ª í…ŒìŠ¤íŠ¸

### í…ŒìŠ¤íŠ¸ ì‹¤í–‰

```bash
# ì „ì²´ í…ŒìŠ¤íŠ¸ ì‹¤í–‰
./gradlew test

# íŠ¹ì • í…ŒìŠ¤íŠ¸ í´ë˜ìŠ¤ ì‹¤í–‰
./gradlew test --tests UserControllerTest

# í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€ ìƒì„±
./gradlew jacocoTestReport

# í…ŒìŠ¤íŠ¸ ë¦¬í¬íŠ¸ í™•ì¸
open build/reports/tests/test/index.html
open build/reports/jacoco/test/html/index.html
```

### í…ŒìŠ¤íŠ¸ êµ¬ì¡°

```
src/test/kotlin/studioxid/protopieassignment/
â”œâ”€â”€ controller/
â”‚   â””â”€â”€ UserControllerTest.kt          # API í†µí•© í…ŒìŠ¤íŠ¸
â”œâ”€â”€ service/
â”‚   â””â”€â”€ UserServiceTest.kt             # ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ í…ŒìŠ¤íŠ¸
â”œâ”€â”€ exception/
â”‚   â””â”€â”€ GlobalExceptionHandlerTest.kt  # ì˜ˆì™¸ ì²˜ë¦¬ í…ŒìŠ¤íŠ¸
â””â”€â”€ TestContainersConfiguration.kt     # í…ŒìŠ¤íŠ¸ ì»¨í…Œì´ë„ˆ ì„¤ì •
```

### í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤

#### 1. ì¸ì¦/ì¸ê°€ í…ŒìŠ¤íŠ¸
- âœ… íšŒì›ê°€ì… ì„±ê³µ/ì‹¤íŒ¨ ì¼€ì´ìŠ¤
- âœ… ë¡œê·¸ì¸ ì„±ê³µ/ì‹¤íŒ¨ ì¼€ì´ìŠ¤
- âœ… JWT í† í° ê²€ì¦
- âœ… ì—­í•  ê¸°ë°˜ ì ‘ê·¼ ì œì–´

#### 2. ì‚¬ìš©ì ê´€ë¦¬ í…ŒìŠ¤íŠ¸
- âœ… ì‚¬ìš©ì CRUD ì‘ì—…
- âœ… ê¶Œí•œë³„ ì ‘ê·¼ ì œì–´
- âœ… ì…ë ¥ê°’ ê²€ì¦
- âœ… ì—ëŸ¬ ì²˜ë¦¬

#### 3. í†µí•© í…ŒìŠ¤íŠ¸
- âœ… ë°ì´í„°ë² ì´ìŠ¤ ì—°ë™
- âœ… ìºì‹œ ë™ì‘
- âœ… ë¹„ë™ê¸° ì²˜ë¦¬
- âœ… ë©”ì‹œì§€ í ì—°ë™
